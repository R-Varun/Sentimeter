<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta name="generator" content=
"HTML Tidy for Linux (vers 25 March 2009), see www.w3.org" />

<title>Conversation Analysis</title><!--Import Google Icon Font-->
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"
type="text/css" /><!--Import jQuery before materialize.js-->

<script type="text/javascript" src="https://code.jquery.com/jquery-3.2.1.min.js">
</script><!-- Compiled and minified CSS -->
<!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/css/materialize.min.css"> -->
<link type="text/css" rel="stylesheet" href="/css/main.css" />
<link rel="stylesheet" href=
"https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/css/materialize.min.css"
type="text/css" /><!-- Compiled and minified JavaScript -->

<script src=
"https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/js/materialize.min.js"
type="text/javascript">
</script>
<script src="../text.js"></script>
<script src="../loadingOverlay.js"></script>


<script type="text/javascript">
//<![CDATA[
    function goToLoadingPage() {
        document.location.href = 'loader.html'
    }
    function goToHomePage() {
        document.location.href = '/'
    }
    function goToLoginPage() {
        document.location.href = 'login'
    }
    function goToHistoryPage() {
        document.location.href = 'history'
    }
//]]>
</script><!--Let browser know website is optimized for mobile-->
<style>
hr.style6 {
	background-color: #fff;
	border-top: 2px dashed #8c8b8b;
}

</style>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
</head>

<body class=" grey lighten-3">
    <div class="navbar-fixed white">
        <div class="nav-wrapper" id = "navBar">
          <!-- <img src="https://cdn.dribbble.com/users/45642/screenshots/1231766/sentimeter_1x.png" alt="SentimeterLogo" style = "height:64px"> -->
          <input class = "inline" type="image" id="myimage" onclick="goToHomePage()" src=
          "/../img/Sentimeter_logo.jpg" style=
          "height:64px" />
        </div>
        </div>
<div align = "center" id = "pastResultsButtonDiv">
    </div>
<textarea style ="width: 0px;min-width: 0px; min-height:0;padding:0!important; height: 0px; visibility:hidden" id = "corpusDisplayArea" class="materialize-textarea text-input"></textarea>
<div class="container">
<div class="step-1 card">
  <div class="card-content">
    <div class="row">

    <span class="card-title">Step 1: Select Text to Analyze</span>
    </div>
      <div id="chooseText">

        <div class="file-field input-field">
                <div class="btn" >
                    <span>File</span>
                    <input type="file" id = "fileInput">
                </div>
                <div class="file-path-wrapper" id="textin" >
                    <input class="file-path validate" placeholder="Upload text file you wish to analyze" type="text">
                </div>

        </div>
        <br>
        <h5 class="grey-text">OR</h5>
        <hr class="style6">
        <br>
        <div class="row">
          <textarea id = "fileDisplayArea" class="materialize-textarea text-input" rows="12" cols="150" placeholder="Paste Text to Analyze Here" >Speaker1: I went to the park</textarea>

          <button data-target="optionsModal" class="btn modal-trigger">Options</button>
          
          <div id="optionsModal" class="modal">
            <div class="modal-content">
              <div class="input-field col s2">
                <input value="\n" id="speaker_delimit" type="text">
                <label class="active" for="speaker_delimit">Speaker Delimiter</label>
              </div>
            <div class="input-field col s2">
                <input value=":" id="speech_delimit" type="text">
                <label class="active" for="speech_delimit">Speech Delimit</label>
            </div>

            <div class="input-field col s2">
                <input value="-1" id="gran_start" type="text">
                <label class="active" for="gran_start">Starting</label>
            </div>
            <div class="input-field col s2">
                <input value="-1" id="gran_end" type="text">
                <label class="active" for="gran_start">Ending</label>
            </div>

            <div class="input-field col s2">
              <input value="1" id="stride" type="text">
              <label class="active" for="stride">Stripe</label>
            </div>

            </div>
            <div class="modal-footer">
              <a href="#!" class="modal-action modal-close waves-effect waves-green btn-flat">Confirm Options</a>

            </div>
          </div>





        </div>



      </div>
  </div>
  </div>

  <div class="step-2 card">
    <div class="card-content">
    <div class="row">

    <span class="card-title">Step 2: Select Language of Text</span>
    </div>
  <div id="chooseLanguage input-field">
    <select>
      <option value="English">
        English
      </option>

      <option value="Spanish">
        Spanish
      </option>

      <option value="French">
        French
      </option>

      <option value="German">
        German
      </option>

      <option value="Chinese">
        Chinese
      </option>

      <option value="Japanese">
        Japanese
      </option>

      <option value="Arabic">
        Arabic
      </option>
    </select>
    </div>
  </div>
</div>

<div class="step-3 card">
    <div class="card-content">
        <div class="row">
                <span class="card-title col-s5">Step 3: Select Corpus</span>

                <div class="help-tip col-s1 offset-s6">
                    <p>A corpus is reference material we use to learn the sentiment of your text.
                      The corpus file should be a text file with data label pairs.</p>
                </div>
        </div>

        <div class="file-field input-field">
                <div class="btn" >
                    <span>File</span>
                    <input type="file" id = "corpusFileInput">
                </div>
                <div class="file-path-wrapper" >
                    <input class="file-path validate" placeholder="Upload the corpus you wish to compare against" type="text">
                </div>
        </div>
    </div>
</div>
<div class="step-4 card">
  <div class="card-content">
      <div class="row">
              <span class="card-title col-s5">Step 4: Name Your Results</span>
      </div>

      <div class="file-field input-field">
              <div class="file-path-wrapper" >
                  <input id = "resultsName" placeholder="Please input the desired name for your results" type="text">
              </div>
      </div>
  </div>
</div>
</div>

<div align="center">
<button type="button" id="processButton" class="waves-light grey btn-large">
Process</button>
</div>

<div class="footer-copyright">
<div class="container" align="bottom"></div>
</div>
</body>
<script>


$(document).ready(function() {
    $('select').material_select();
    $('.modal').modal();
    customize();



  });

window.onload = function() {
		var fileInput = document.getElementById('fileInput');
		var fileDisplayArea = document.getElementById('fileDisplayArea');

		fileInput.addEventListener('change', function(e) {
			var file = fileInput.files[0];
			var textType = /text.*/;

			if (file.type.match(textType)) {
				var reader = new FileReader();

				reader.onload = function(e) {
					fileDisplayArea.innerText = reader.result;
				}

				reader.readAsText(file);
			}
    });

    var corpusFileInput = document.getElementById('corpusFileInput');
    var corpusFileDisplayArea = document.getElementById('corpusDisplayArea');

    corpusFileInput.addEventListener('change', function(e) {
        var file = corpusFileInput.files[0];
        var textType = /text.*/;

        if (file.type.match(textType)) {
            var reader = new FileReader();

            reader.onload = function(e) {
                corpusFileDisplayArea.innerText = reader.result;
            }

            reader.readAsText(file);
        } else {
            fileDisplayArea.innerText = "File not supported!";
        }
    });
}


  $("#processButton").click(function() {
    var spinHandle = loadingOverlay().activate();
    setTimeout(function() {

    loadingOverlay().cancel(spinHandle);
    }, 3000);

    submit();

  }
     );

function customize() {
  $.post("/auth", function(data, s, x) {
    console.log(data);
    if (data.data == true) {
      $("#pastResultsButtonDiv").append(
      );
      $("#navBar").append(
      `<ul class="right">
          <button style="margin-right:1rem;" type="button" class="btn waves-effect waves-light orange"  onclick="goToHistoryPage()">View Past Results</button>

          <button style="margin-right:1rem;" type="button" class="btn waves-effect waves-light orange" id = "LoginButton" onclick="goToLoginPage()"> Logout</button>
      </ul>`.toString()
  );
    } else {
      $("#navBar").append(
      `<ul class="right">
          <button style="margin-right:1rem;" type="button" class="btn waves-effect waves-light orange" id = "LoginButton" onclick="goToLoginPage()"> Login</button>
      </ul>`.toString()
  );
    }

  })
  
}

function submit() {

  var text = $("#fileDisplayArea").val();
  var corpusTextRaw = $("#corpusDisplayArea").val();
  var resultsName = $("#resultsName").val();

  console.log(corpusText);
  var corpusText = corpusTextRaw.replace("\\t", "\t").replace("\\n", "\n")
  var sp_del = $("#speaker_delimit").val().replace("\\n","\n");
  var s_del = $("#speech_delimit").val()

  var gran_start = parseInt($("#gran_start").val()) ;
  var gran_end = parseInt($("#gran_end").val()) ;
  var gran = [gran_start, gran_end];


  var stride = parseInt($("#stride").val()) ;

  if (gran_start < 0 || gran_end < 0) {
    gran = [-1,-1];
  }


  var retObj = {}

  retObj["granularity"] = gran;
  retObj["corpus"] = corpusText;
  console.log(corpusText);
  retObj["stride"] = stride;
  retObj["resultsName"] = resultsName;
  split_speech = text.split(sp_del);

  retObj["data"] = [];
  console.log(text.split(sp_del));
  for (var i = 0; i < split_speech.length; i++) {
    var spl = split_speech[i].split(s_del);

    retObj["data"].push({speaker: spl[0], utterance: spl[1]});
  }
  // console.log(JSON.stringify(retObj));
  console.dir(retObj)
  $.post("/api/analyze", retObj,submitted);


}

function submitted(data, s, x)  {
  console.log("dddddd")
  console.log(data);
  window.location = "/feature";


}
</script>
</html>
